syntax = "proto3";

package internal;

option go_package = "github.com/ehrlich-b/tunn/pkg/proto/internalv1";

service InternalService {
  rpc FindTunnel(FindTunnelRequest) returns (FindTunnelResponse);
  rpc ForwardUdpPacket(ForwardUdpPacketRequest) returns (ForwardUdpPacketResponse);
  rpc GetNodeInfo(NodeInfoRequest) returns (NodeInfoResponse);
}

// Node information for login node discovery
message NodeInfoRequest {}

message NodeInfoResponse {
  bool is_login_node = 1;
  string node_id = 2;
}

message FindTunnelRequest {
  string tunnel_id = 1;
}

message FindTunnelResponse {
  bool found = 1;
  // The address of the node handling the tunnel.
  // If found is true, this will be the address of the node.
  // The caller can then use this address to forward the request.
  string node_address = 2;
}

message ForwardUdpPacketRequest {
  string tunnel_id = 1;
  string source_address = 2;
  bytes data = 3;
}

message ForwardUdpPacketResponse {
  bool success = 1;
  bytes response_data = 2;
  string error_message = 3;
}
